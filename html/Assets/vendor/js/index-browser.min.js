((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@influxdata/influxdb-client"]={})})(this,function(e){var t=(()=>{var n=Object.defineProperty,N=Object.getOwnPropertyDescriptor,P=Object.getOwnPropertyNames,M=Object.prototype.hasOwnProperty,e={};function p(){let s=new TextDecoder("utf-8");return{concat(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r},copy(e,t,r){var s=new Uint8Array(r-t);return s.set(e.subarray(t,r)),s},toUtf8String(e,t,r){return s.decode(e.subarray(t,r))}}}function t(o,e){let a=null!=e?e:p(),l,u=!1,h=!1,c=!1,f;let d={next(e){if(!u)try{return function e(t){let r,s=0;for(l?(r=0===t.length?0:l.length,t=a.concat(l,t)):r=0;r<t.length;){var i=t[r];if(10===i){if(!h){var n=0<r&&13===t[r-1]?r-1:r;if(u)return;if(c=!1===o.next(a.toUtf8String(t,s,n)),s=r+1,c)break}}else 34===i&&(h=!h);r++}if(l=s<t.length?a.copy(t,s,t.length):void 0,c){if(o.useResume)return void o.useResume(()=>{c=!1,e(new Uint8Array(0))});d.error(new Error("Unable to pause, useResume is not configured!")),c=!1}f&&(f(),f=void 0)}(e),!c}catch(e){this.error(e)}return!0},error(e){u||(u=!0,o.error(e))},complete(){u||(l&&o.next(a.toUtf8String(l,0,l.length)),u=!0,o.complete())}};return o.useCancellable&&(d.useCancellable=e=>{o.useCancellable&&o.useCancellable({cancel(){e.cancel(),l=void 0,d.complete()},isCancelled(){return e.isCancelled()}})}),o.useResume&&(d.useResume=e=>{f=e}),d}async function*r(e,t){let r=null!=t?t:p(),s,i=!1;for await(var n of e){let e,t=0;for(s?(e=s.length,n=r.concat(s,n)):e=0;e<n.length;){var o,a=n[e];10===a?i||(o=0<e&&13===n[e-1]?e-1:e,yield r.toUtf8String(n,t,o),t=e+1):34===a&&(i=!i),e++}s=t<n.length?r.copy(n,t,n.length):void 0}s&&(yield r.toUtf8String(s,0,s.length))}((e,t)=>{for(var r in t)n(e,r,{get:t[r],enumerable:!0})})(e,{AbortError:()=>y,DEFAULT_ConnectionOptions:()=>H,DEFAULT_RetryDelayStrategyOptions:()=>q,DEFAULT_WriteOptions:()=>W,FLUX_VALUE:()=>D,HttpError:()=>f,IllegalArgumentError:()=>c,InfluxDB:()=>de,LineSplitter:()=>u,Log:()=>C,Point:()=>ie,RequestTimedOutError:()=>$,UNKNOWN_COLUMN:()=>a,canRetryHttpCall:()=>function(e){if(e){if("function"==typeof e.canRetry)return!!e.canRetry();if(e.code&&U.includes(e.code))return!0}return!1},chunksToLines:()=>t,chunksToLinesIterable:()=>r,consoleLogger:()=>re,convertTimeToNanos:()=>te,createFluxTableColumn:()=>function(e){let t,r,s=new o;return s.label=String(e.label),s.dataType=e.dataType,s.group=!!e.group,s.defaultValue=null!=(t=e.defaultValue)?t:"",s.index=null!=(r=e.index)?r:0,s},createFluxTableMetaData:()=>g,createTextDecoderCombiner:()=>p,currentTime:()=>Z,dateToProtocolTimestamp:()=>ee,escape:()=>T,flux:()=>function(s,...i){if(1==s.length&&0===i.length)return I(s[0]);let n=new Array(s.length+i.length),o=0;for(let r=0;r<s.length;r++){var a=s[r];if(n[o++]=a,r<i.length){let e=i[r],t;if(a.endsWith('"')&&r+1<s.length&&s[r+1].startsWith('"'))t=B(e);else if(""===(t=j(e))&&!(e=>"object"==typeof e&&"function"==typeof e[D])(e))throw new Error(`Unsupported parameter literal '${e}' at index: ${r}, type: `+typeof e);n[o++]=t}else if(r<s.length-1)throw new Error("Too few parameters supplied!")}return I(n.join(""))},fluxBool:()=>function(e){return new A("true"===e||"false"===e?e:(!!e).toString())},fluxDateTime:()=>function(e){return new A((e=>`time(v: "${B(e)}")`)(e))},fluxDuration:()=>function(e){return new A(`duration(v: "${B(e)}")`)},fluxExpression:()=>I,fluxFloat:()=>function(e){return new A(L(e))},fluxInteger:()=>function(e){return new A(_(e))},fluxRegExp:()=>function(e){return new A(se(e))},fluxString:()=>function(e){return new A(`"${B(e)}"`)},getRetryDelay:()=>d,isStatusCodeRetriable:()=>l,linesToRowsIterable:()=>w,linesToTables:()=>m,newFluxTableColumn:()=>h,sanitizeFloat:()=>L,sanitizeInteger:()=>_,serializeDateTimeAsDate:()=>function(){i["dateTime:RFC3339"]=e=>""===e?null:new Date(Date.parse(e))},serializeDateTimeAsNumber:()=>function(){i["dateTime:RFC3339"]=e=>""===e?null:Date.parse(e)},serializeDateTimeAsString:()=>function(){i["dateTime:RFC3339"]=e=>""===e?null:e},setLogger:()=>function(e){var t=O;return O=e,t},stringToLines:()=>function(e,t){let r=!1,s=0,i=0;for(;i<e.length;){var n,o=e.charCodeAt(i);10===o?r||(n=0<i&&13===e.charCodeAt(i-1)?i-1:i,t.next(e.substring(s,n)),s=i+1):34===o&&(r=!r),i++}s<i&&t.next(e.substring(s,i)),t.complete()},symbolObservable:()=>b,toFluxValue:()=>j,typeSerializers:()=>i,useProcessHrtime:()=>G});var u=class{constructor(){this._reuse=!1}get reuse(){return this._reuse}set reuse(e){e&&!this.reusedValues&&(this.reusedValues=new Array(10)),this._reuse=e}withReuse(){return this.reuse=!0,this}splitLine(t){if(null==t)return this.lastSplitLength=0,[];let r=0,s=0,i=this._reuse?this.reusedValues:[],n=0;for(let e=0;e<t.length;e++){var o,a=t[e];","===a?r%2==0&&(o=this.getValue(t,s,e,r),this._reuse?i[n++]=o:i.push(o),s=e+1,r=0):'"'===a&&r++}var e=this.getValue(t,s,t.length,r);return this._reuse?(i[n]=e,this.lastSplitLength=n+1):(i.push(e),this.lastSplitLength=i.length),i}getValue(e,t,r,s){return t===e.length?"":0===s?e.substring(t,r):2===s?e.substring(t+1,r-1):e.substring(t+1,r-1).replace(/""/gi,'"')}},s=e=>e,i={boolean:e=>""===e?null:"true"===e,unsignedLong:e=>""===e?null:+e,long:e=>""===e?null:+e,double(e){switch(e){case"":return null;case"+Inf":return Number.POSITIVE_INFINITY;case"-Inf":return Number.NEGATIVE_INFINITY;default:return+e}},string:s,base64Binary:s,duration:e=>""===e?null:e,"dateTime:RFC3339":e=>""===e?null:e},o=class{get(e){let t,r=e[this.index];return""!==r&&void 0!==r||!this.defaultValue||(r=this.defaultValue),(null!=(t=i[this.dataType])?t:s)(r)}},a=Object.freeze({label:"",dataType:"",group:!1,defaultValue:"",index:Number.MAX_SAFE_INTEGER,get:()=>{}});function h(){return new o}var k=[404,408,425,429,500,502,503,504];function l(e){return k.includes(e)}var c=class pe extends Error{constructor(e){super(e),this.name="IllegalArgumentError",Object.setPrototypeOf(this,pe.prototype)}},f=class ye extends Error{constructor(e,t,r,s,i,n,o){if(super(),this.statusCode=e,this.statusMessage=t,this.body=r,this.contentType=i,Object.setPrototypeOf(this,ye.prototype),this.headers=o,n)this.message=n;else if(r){if(null!=i&&i.startsWith("application/json"))try{this.json=JSON.parse(r),this.message=this.json.message,this.code=this.json.code}catch(e){}this.message||(this.message=e+` ${t} : `+r)}else this.message=e+" "+t;this.name="HttpError",this.setRetryAfter(s)}setRetryAfter(e){"string"==typeof e&&/^[0-9]+$/.test(e)?this._retryAfter=parseInt(e):this._retryAfter=0}canRetry(){return l(this.statusCode)}retryAfter(){return this._retryAfter}},U=["ECONNRESET","ENOTFOUND","ESOCKETTIMEDOUT","ETIMEDOUT","ECONNREFUSED","EHOSTUNREACH","EPIPE"];function d(e,t){return e?"function"==typeof e.retryAfter?e.retryAfter():t&&0<t?0+Math.round(Math.random()*t):0:0}var $=class ge extends Error{constructor(){super(),Object.setPrototypeOf(this,ge.prototype),this.name="RequestTimedOutError",this.message="Request timed out"}canRetry(){return!0}retryAfter(){return 0}},y=class me extends Error{constructor(){super(),this.name="AbortError",Object.setPrototypeOf(this,me.prototype),this.message="Response aborted"}canRetry(){return!0}retryAfter(){return 0}};var z=class{constructor(e){e.forEach((e,t)=>e.index=t),this.columns=e}column(t,e=!0){for(let e=0;e<this.columns.length;e++){var r=this.columns[e];if(r.label===t)return r}if(e)throw new c(`Column ${t} not found!`);return a}toObject(t){var r={};for(let e=0;e<this.columns.length&&e<t.length;e++){var s=this.columns[e];r[s.label]=s.get(t)}return r}get(e,t){return this.column(t,!1).get(e)}};function g(e){return new z(e)}function m(s){let i=(new u).withReuse(),n,o=!0,a=0,l,e={error(e){s.error(e)},next(e){if(""===e)o=!0,n=void 0;else{var t=i.splitLine(e),r=i.lastSplitLength;if(!o)return s.next(t.slice(a,r),l);if(!n){n=new Array(r);for(let e=0;e<r;e++)n[e]=h()}if(t[0].startsWith("#")){if("#datatype"===t[0])for(let e=1;e<r;e++)n[e].dataType=t[e];else if("#default"===t[0])for(let e=1;e<r;e++)n[e].defaultValue=t[e];else if("#group"===t[0])for(let e=1;e<r;e++)n[e].group="t"===t[e][0]}else{""===t[0]?(a=1,n=n.slice(1)):a=0;for(let e=a;e<r;e++)n[e-a].label=t[e];l=g(n),o=!1}}return!0},complete(){s.complete()}};return s.useCancellable&&(e.useCancellable=s.useCancellable.bind(s)),s.useResume&&(e.useResume=s.useResume.bind(s)),e}async function*w(e){let t=(new u).withReuse(),r,s=!0,i=0,n;for await(var o of e)if(""===o)s=!0,r=void 0;else{var a=t.splitLine(o),l=t.lastSplitLength;if(s){if(!r){r=new Array(l);for(let e=0;e<l;e++)r[e]=h()}if(a[0].startsWith("#")){if("#datatype"===a[0])for(let e=1;e<l;e++)r[e].dataType=a[e];else if("#default"===a[0])for(let e=1;e<l;e++)r[e].defaultValue=a[e];else if("#group"===a[0])for(let e=1;e<l;e++)r[e].group="t"===a[e][0]}else{""===a[0]?(i=1,r=r.slice(1)):i=0;for(let e=i;e<l;e++)r[e-i].label=a[e];n=g(r),s=!1}}else yield{values:a.slice(i,l),tableMeta:n}}}var b="function"==typeof Symbol&&Symbol.observable||"@@observable",V=class{constructor(t,e){this.isClosed=!1;try{e({next:e=>{t.next(e)},error:e=>{this.isClosed=!0,t.error(e)},complete:()=>{this.isClosed=!0,t.complete()},useCancellable:e=>{this.cancellable=e}})}catch(e){this.isClosed=!0,t.error(e)}}get closed(){return this.isClosed}unsubscribe(){var e;null!=(e=this.cancellable)&&e.cancel(),this.isClosed=!0}};function x(){}var v=class{constructor(e,t){this.executor=e,this.decorator=t}subscribe(e,t,r){t=(e=>{var{next:t,error:r,complete:s}=e;return{next:t?t.bind(e):x,error:r?r.bind(e):x,complete:s?s.bind(e):x}})("object"!=typeof e||null===e?{next:e,error:t,complete:r}:e);return new V(this.decorator(t),this.executor)}[b](){return this}},H={timeout:1e4},q={retryJitter:200,minRetryDelay:5e3,maxRetryDelay:125e3,exponentialBase:5,randomRetry:!0},W={batchSize:1e3,maxBatchBytes:5e7,flushInterval:6e4,writeFailed:function(){},writeSuccess:function(){},writeRetrySkipped:function(){},maxRetries:5,maxRetryTime:18e4,maxBufferLines:32e3,retryJitter:200,minRetryDelay:5e3,maxRetryDelay:125e3,exponentialBase:2,gzipThreshold:1e3,randomRetry:!0};function R(n,o){return function(e){let t="",r=0,s=0;for(;s<e.length;){var i=n.indexOf(e[s]);0<=i&&(t=(t+=e.substring(r,s))+o[i],r=s+1),s++}return 0==r?e:(r<e.length&&(t+=e.substring(r,e.length)),t)}}var T={measurement:R(`, 
\r	`,["\\,","\\ ","\\n","\\r","\\t"]),quoted:((e,t)=>{let r=R(e,t);return e=>'"'+r(e)+'"'})('"\\',['\\"',"\\\\"]),tag:R(`, =
\r	`,["\\,","\\ ","\\=","\\n","\\r","\\t"])},J="000000000";function G(e){return!1}var X=Date.now(),S=0;function E(){var e=Date.now(),t=(e!==X?(X=e,S=0):S++,String(S));return String(e)+J.substr(0,6-t.length)+t}function K(){return String(Date.now())+J.substr(0,3)}function Y(){return String(Date.now())}function Q(){return String(Math.floor(Date.now()/1e3))}var Z={s:Q,ms:Y,us:K,ns:E,seconds:Q,millis:Y,micros:K,nanos:E},ee={s:e=>""+Math.floor(e.getTime()/1e3),ms:e=>""+e.getTime(),us:e=>e.getTime()+"000",ns:e=>e.getTime()+"000000"};function te(e){return void 0===e?E():"string"==typeof e?0<e.length?e:void 0:e instanceof Date?e.getTime()+"000000":String("number"==typeof e?Math.floor(e):e)}var re={error(e,t){console.error("ERROR: "+e,t||"")},warn(e,t){console.warn("WARN: "+e,t||"")}},O=re,C={error(e,t){O.error(e,t)},warn(e,t){O.warn(e,t)}};var D=Symbol("FLUX_VALUE"),A=class{constructor(e){this.fluxValue=e}toString(){return this.fluxValue}[D](){return this.fluxValue}};function B(e){if(null==e)return"";e=e.toString();let t,r=0;function s(){void 0===t&&(t=e.substring(0,r))}for(;r<e.length;r++){var i=e.charAt(r);switch(i){case"\r":s(),t+="\\r";break;case`
`:s(),t+="\\n";break;case"\t":s(),t+="\\t";break;case'"':case"\\":s(),t=t+"\\"+i;break;case"$":r+1<e.length&&"{"===e.charAt(r+1)?(s(),r++,t+="\\${"):null!=t&&(t+=i);break;default:null!=t&&(t+=i)}}return void 0!==t?t:e}function L(e){var t,r=Number(e);if(!isFinite(r)){if("number"==typeof e)return`float(v: "${r}")`;throw new Error("not a flux float: "+e)}let s=r.toString(),i=!1;for(t of s)if(!("0"<=t&&t<="9"||"-"==t)){if("."!==t)return`float(v: "${s}")`;i=!0;continue}return i?s:s+".0"}function _(e){var t,r=String(e),e=r.startsWith("-"),s=e?r.substring(1):r;if(0===s.length||19<s.length)throw new Error("not a flux integer: "+r);for(t of s)if(t<"0"||"9"<t)throw new Error("not a flux integer: "+r);if(19===s.length){if(e&&"9223372036854775808"<s)throw new Error("flux integer out of bounds: "+r);if(!e&&"9223372036854775807"<s)throw new Error("flux integer out of bounds: "+r)}return r}function se(e){return(e instanceof RegExp?e:new RegExp(e)).toString()}function I(e){return new A(String(e))}function j(e){if(void 0===e)return"";if(null===e)return"null";if("boolean"==typeof e)return e.toString();if("string"==typeof e)return`"${B(e)}"`;if("number"==typeof e)return(Number.isSafeInteger(e)?_:L)(e);if("object"==typeof e){if("function"==typeof e[D])return e[D]();if(e instanceof Date)return e.toISOString();if(e instanceof RegExp)return se(e);if(Array.isArray(e))return`[${e.map(j).join(",")}]`}else if("bigint"==typeof e)return e+".0";return j(e.toString())}var ie=class{constructor(e){this.tags={},this.fields={},e&&(this.name=e)}measurement(e){return this.name=e,this}tag(e,t){return this.tags[e]=t,this}booleanField(e,t){return this.fields[e]=t?"T":"F",this}intField(e,t){let r;if(r="number"==typeof t?t:parseInt(String(t)),isNaN(r)||r<=-0x8000000000000000||0x8000000000000000<=r)throw new Error(`invalid integer value for field '${e}': '${t}'!`);return this.fields[e]=Math.floor(r)+"i",this}uintField(e,t){if("number"==typeof t){if(isNaN(t)||t<0||t>Number.MAX_SAFE_INTEGER)throw new Error(`uint value for field '${e}' out of range: `+t);this.fields[e]=Math.floor(t)+"u"}else{var r=String(t);for(let e=0;e<r.length;e++){var s=r.charCodeAt(e);if(s<48||57<s)throw new Error(`uint value has an unsupported character at pos ${e}: `+t)}if(20<r.length||20===r.length&&0<r.localeCompare("18446744073709551615"))throw new Error(`uint value for field '${e}' out of range: `+r);this.fields[e]=r+"u"}return this}floatField(e,t){let r;if(r="number"==typeof t?t:parseFloat(t),isFinite(r))return this.fields[e]=String(r),this;throw new Error(`invalid float value for field '${e}': `+t)}stringField(e,t){return null!=t&&("string"!=typeof t&&(t=String(t)),this.fields[e]=T.quoted(t)),this}timestamp(e){return this.time=e,this}toLineProtocol(t){if(this.name){let i="";if(Object.keys(this.fields).sort().forEach(e=>{var t;e&&(t=this.fields[e],0<i.length&&(i+=","),i+=T.tag(e)+"="+t)}),0!==i.length){let r="",s=t&&t.defaultTags?{...t.defaultTags,...this.tags}:this.tags,e=(Object.keys(s).sort().forEach(e=>{var t;e&&(t=s[e])&&(r=(r+=",")+(T.tag(e)+"="+T.tag(t)))}),this.time);return e=t&&t.convertTime?t.convertTime(e):te(e),""+T.measurement(this.name)+r+" "+i+(void 0!==e?" "+e:"")}}}toString(){return this.toLineProtocol(void 0)||"invalid point: "+JSON.stringify(this,void 0)}},ne=class{constructor(e){this.options={...q,...e},this.success()}nextDelay(e,s){e=d(e);if(e&&0<e)return e+Math.round(Math.random()*this.options.retryJitter);if(s&&0<s){if(this.options.randomRetry){let t=Math.max(this.options.minRetryDelay,1),r=t*this.options.exponentialBase;for(let e=1;e<s;e++)if(t=r,(r*=this.options.exponentialBase)>=this.options.maxRetryDelay){r=this.options.maxRetryDelay;break}return t+Math.round(Math.random()*(r-t)+Math.random()*this.options.retryJitter)}let t=Math.max(this.options.minRetryDelay,1);for(let e=1;e<s;e++)if((t*=this.options.exponentialBase)>=this.options.maxRetryDelay){t=this.options.maxRetryDelay;break}return t+Math.round(Math.random()*this.options.retryJitter)}return this.currentDelay?this.currentDelay=Math.min(Math.max(this.currentDelay*this.options.exponentialBase,1)+Math.round(Math.random()*this.options.retryJitter),this.options.maxRetryDelay):this.currentDelay=this.options.minRetryDelay+Math.round(Math.random()*this.options.retryJitter),this.currentDelay}success(){this.currentDelay=void 0}};var oe=class{constructor(e,t,r=()=>{}){this.maxLines=e,this.retryLines=t,this.onShrink=r,this.size=0,this.closed=!1,this._timeoutHandle=void 0}addLines(i,n,o,a){if(!this.closed&&i.length){let e=Date.now()+o;if(a<e&&(e=a),this.first&&this.size+i.length>this.maxLines){var o=this.size,l=.7*o;do{var[u,h]=(e=>{let t,r=e,s=e;for(;s.next;)s.next.expires<r.expires&&(t=s,r=s.next),s=s.next;return[r,t]})(this.first);this.size-=u.lines.length,h?h.next=u.next:(this.first=u.next,this.first&&this.scheduleRetry(this.first.retryTime-Date.now())),u.next=void 0,this.onShrink(u)}while(this.first&&this.size+i.length>l);C.error(`RetryBuffer: ${o-this.size} oldest lines removed to keep buffer size under the limit of ${this.maxLines} lines.`)}let t={lines:i,retryCount:n,retryTime:e,expires:a},r=this.first,s;for(;;){if(!r||r.retryTime>e){t.next=r,s?s.next=t:(this.first=t,this.scheduleRetry(e-Date.now()));break}r=(s=r).next}this.size+=i.length}}removeLines(){var e;if(this.first)return e=this.first,this.first=this.first.next,e.next=void 0,this.size-=e.lines.length,e}scheduleRetry(e){this._timeoutHandle&&clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout(()=>{var e=this.removeLines();e?this.retryLines(e.lines,e.retryCount,e.expires).catch(()=>{}).finally(()=>{this.first&&this.scheduleRetry(this.first.retryTime-Date.now())}):this._timeoutHandle=void 0},Math.max(e,0))}async flush(){for(var e;e=this.removeLines();)await this.retryLines(e.lines,e.retryCount,e.expires)}close(){return this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=void 0),this.closed=!0,this.size}};var ae=class{constructor(e,t,r,s){this.maxChunkRecords=e,this.maxBatchBytes=t,this.flushFn=r,this.scheduleSend=s,this.length=0,this.bytes=-1,this.lines=new Array(e)}add(e){var t=(t=>{let r=t.length;for(let e=0;e<t.length;e++){var s=t.charCodeAt(e);s<128||(128<=s&&s<=2047?r++:2048<=s&&s<=65535?55296<=s&&s<=57343?r++:r+=2:r+=3)}return r})(e);0===this.length?this.scheduleSend():this.bytes+t+1>=this.maxBatchBytes&&this.flush().catch(e=>{}),this.lines[this.length]=e,this.length++,this.bytes+=t+1,(this.length>=this.maxChunkRecords||this.bytes>=this.maxBatchBytes)&&this.flush().catch(e=>{})}flush(){var e=this.reset();return 0<e.length?this.flushFn(e):Promise.resolve()}reset(){var e=this.lines.slice(0,this.length);return this.length=0,this.bytes=-1,e}},le=class{constructor(e,t,r,s,i){this.transport=e,this.closed=!1,this._timeoutHandle=void 0,this.path=`/api/v2/write?org=${encodeURIComponent(t)}&bucket=${encodeURIComponent(r)}&precision=`+s,null!=i&&i.consistency&&(this.path+="&consistency="+encodeURIComponent(i.consistency)),this.writeOptions={...W,...i},this.currentTime=Z[s],this.dateToProtocolTimestamp=ee[s],this.writeOptions.defaultTags&&this.useDefaultTags(this.writeOptions.defaultTags),this.sendOptions={method:"POST",headers:{"content-type":"text/plain; charset=utf-8",...null==i?void 0:i.headers},gzipThreshold:this.writeOptions.gzipThreshold};this.writeBuffer=new ae(this.writeOptions.batchSize,this.writeOptions.maxBatchBytes,e=>(this._clearFlushTimeout(),this.sendBatch(e,this.writeOptions.maxRetries)),()=>{0<this.writeOptions.flushInterval&&(this._clearFlushTimeout(),this.closed||(this._timeoutHandle=setTimeout(()=>this.sendBatch(this.writeBuffer.reset(),this.writeOptions.maxRetries).catch(e=>{}),this.writeOptions.flushInterval)))}),this.sendBatch=this.sendBatch.bind(this),this.retryStrategy=(e=this.writeOptions,new ne(e)),this.retryBuffer=new oe(this.writeOptions.maxBufferLines,this.sendBatch,this.writeOptions.writeRetrySkipped)}sendBatch(a,l,u=Date.now()+this.writeOptions.maxRetryTime){let h=this,c=h.writeOptions.maxRetries+1-l;var e;return!this.closed&&0<a.length?u<=Date.now()?(e=new Error("Max retry time exceeded."),h.writeOptions.writeFailed.call(h,e,a,c,u)||(C.error(`Write to InfluxDB failed (attempt: ${c}).`,e),Promise.reject(e))):new Promise((r,s)=>{let i,n,o={responseStarted(e,t){i=t,n=e},error(e){var t=h.writeOptions.writeFailed.call(h,e,a,c,u);t?t.then(r,s):e instanceof f&&e.json&&"string"==typeof e.json.error&&e.json.error.includes("hinted handoff queue not empty")?(C.warn("Write to InfluxDB returns: "+e.json.error),i=204,o.complete()):(!h.closed&&0<l&&(!(e instanceof f)||429<=e.statusCode)?(C.warn(`Write to InfluxDB failed (attempt: ${c}).`,e),h.retryBuffer.addLines(a,l-1,h.retryStrategy.nextDelay(e,c),u)):C.error("Write to InfluxDB failed.",e),s(e))},complete(){var e,t;204==i||201==i||null==i?(h.writeOptions.writeSuccess.call(h,a),h.retryStrategy.success(),r()):(e=`204 HTTP response status code expected, but ${i} returned`,(t=new f(i,e,void 0,"0",void 0,void 0,n)).message=e,o.error(t))}};this.transport.send(this.path,a.join(`
`),this.sendOptions,o)}):Promise.resolve()}_clearFlushTimeout(){void 0!==this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=void 0)}writeRecord(e){if(this.closed)throw new Error("writeApi: already closed!");this.writeBuffer.add(e)}writeRecords(t){if(this.closed)throw new Error("writeApi: already closed!");for(let e=0;e<t.length;e++)this.writeBuffer.add(t[e])}writePoint(e){if(this.closed)throw new Error("writeApi: already closed!");e=e.toLineProtocol(this);e&&this.writeBuffer.add(e)}writePoints(t){if(this.closed)throw new Error("writeApi: already closed!");for(let e=0;e<t.length;e++){var r=t[e].toLineProtocol(this);r&&this.writeBuffer.add(r)}}async flush(e){if(await this.writeBuffer.flush(),e)return this.retryBuffer.flush()}close(){return this.writeBuffer.flush().finally(()=>{var e=this.retryBuffer.close();e&&C.error(`Retry buffer closed with ${e} items that were not written to InfluxDB!`,null),this.closed=!0})}dispose(){return this._clearFlushTimeout(),this.closed=!0,this.retryBuffer.close()+this.writeBuffer.length}useDefaultTags(e){return this.defaultTags=e,this}convertTime(e){return void 0===e?this.currentTime():"string"==typeof e?0<e.length?e:void 0:e instanceof Date?this.dateToProtocolTimestamp(e):String("number"==typeof e?Math.floor(e):e)}};function F(e){let s={};return e.headers.forEach((e,t)=>{var r=s[t];void 0===r?s[t]=e:Array.isArray(r)?r.push(e):s[t]=[r,e]}),s}var ue=class{constructor(e){this.connectionOptions=e,this.chunkCombiner=p(),this.requestDecorator=function(){},this.defaultHeaders={"content-type":"application/json; charset=utf-8",...e.headers},this.connectionOptions.token&&(this.defaultHeaders.Authorization="Token "+this.connectionOptions.token),this.url=String(this.connectionOptions.url),this.url.endsWith("/")&&(this.url=this.url.substring(0,this.url.length-1)),this.url.endsWith("/api/v2")&&(this.url=this.url.substring(0,this.url.length-7),C.warn(`Please remove '/api/v2' context path from InfluxDB base url, using ${this.url} !`))}send(e,t,r,i){let n=((r={})=>{let t=0,e={next:e=>{if(0===t&&r.next&&null!=e)return r.next(e)},error:e=>{0===t&&(t=1,r.error)&&r.error(e)},complete:()=>{0===t&&(t=2,r.complete)&&r.complete()},responseStarted:(e,t)=>{r.responseStarted&&r.responseStarted(e,t)}};return r.useCancellable&&(e.useCancellable=r.useCancellable.bind(r)),r.useResume&&(e.useResume=r.useResume.bind(r)),e})(i),o=!1,s=r.signal,a,l=()=>{},u=l;if(i&&i.useCancellable){let e=new AbortController;s||(s=e.signal,r={...r,signal:s}),s.addEventListener("abort",()=>{u()}),i.useCancellable({cancel(){o=!0,e.abort()},isCancelled(){return o||s.aborted}})}this.fetch(e,t,r).then(async r=>{if(null!=i&&i.responseStarted&&n.responseStarted(F(r),r.status),await this.throwOnErrorResponse(r),r.body){let e=r.body.getReader(),t;do{if(a&&await a,o)break;if(t=await e.read(),!1===n.next(t.value)){let t=n.useResume;var s;if(!t)return s="Unable to pause, useResume is not configured!",await e.cancel(s),Promise.reject(new Error(s));a=new Promise(e=>{u=()=>{e(),a=void 0,u=l},t(u)})}}while(!t.done)}else{var e;r.arrayBuffer?(e=await r.arrayBuffer(),n.next(new Uint8Array(e))):(e=await r.text(),n.next((new TextEncoder).encode(e)))}}).catch(e=>{o||n.error(e)}).finally(()=>n.complete())}async throwOnErrorResponse(t){if(300<=t.status){let e="";try{var r;(e=await t.text())||(r=t.headers.get("x-influxdb-error"))&&(e=r)}catch(e){throw C.warn("Unable to receive error body",e),new f(t.status,t.statusText,void 0,t.headers.get("retry-after"),t.headers.get("content-type"),void 0,F(t))}throw new f(t.status,t.statusText,e,t.headers.get("retry-after"),t.headers.get("content-type"),void 0,F(t))}}async*iterate(e,t,r){var s=await this.fetch(e,t,r);if(await this.throwOnErrorResponse(s),s.body)for(var i=s.body.getReader();;){var{value:n,done:o}=await i.read();if(o)break;if(null!=(o=r.signal)&&o.aborted)throw await s.body.cancel(),new y;yield n}else s.arrayBuffer?(e=await s.arrayBuffer(),yield new Uint8Array(e)):(t=await s.text(),yield(new TextEncoder).encode(t))}async request(e,t,r,s){e=await this.fetch(e,t,r),t=e.headers,t=t.get("content-type")||"",s&&s(F(e),e.status),await this.throwOnErrorResponse(e),s=null!=(r=null==(s=r.headers)?void 0:s.accept)?r:t;return s.includes("json")?e.json():s.includes("text")||s.startsWith("application/csv")?e.text():void 0}fetch(e,t,r){let{method:s,headers:i,...n}=r,o=""+this.url+e,a={method:s,body:"GET"===s||"HEAD"===s?void 0:"string"==typeof t?t:JSON.stringify(t),headers:{...this.defaultHeaders,...i},credentials:"omit",...this.connectionOptions.transportOptions,...n};return this.requestDecorator(a,r,o),fetch(o,a)}},he={header:!0,delimiter:",",quoteChar:'"',commentPrefix:"#",annotations:["datatype","group","default"]},ce=class we{constructor(e,t,r){this.transport=e,this.createCSVResponse=t,this.options="string"==typeof r?{org:r}:r}with(e){return new we(this.transport,this.createCSVResponse,{...this.options,...e})}response(e){let{org:t,type:r,gzip:s,headers:i}=this.options,n="/api/v2/query?org="+encodeURIComponent(t),o=JSON.stringify(this.decorateRequest({query:e.toString(),dialect:he,type:r})),a={method:"POST",headers:{"content-type":"application/json; encoding=utf-8","accept-encoding":s?"gzip":"identity",...i}};return this.createCSVResponse(e=>this.transport.send(n,o,a,e),()=>this.transport.iterate(n,o,a))}iterateLines(e){return this.response(e).iterateLines()}iterateRows(e){return this.response(e).iterateRows()}lines(e){return this.response(e).lines()}rows(e){return this.response(e).rows()}queryLines(e,t){return this.response(e).consumeLines(t)}queryRows(e,t){return this.response(e).consumeRows(t)}collectRows(e,t){return this.response(e).collectRows(t)}collectLines(e){return this.response(e).collectLines()}queryRaw(e){var{org:t,type:r,gzip:s,headers:i}=this.options;return this.transport.request("/api/v2/query?org="+encodeURIComponent(t),JSON.stringify(this.decorateRequest({query:e.toString(),dialect:he,type:r})),{method:"POST",headers:{accept:"text/csv","accept-encoding":s?"gzip":"identity","content-type":"application/json; encoding=utf-8",...i}})}decorateRequest(e){var t;return"function"==typeof this.options.now&&(e.now=this.options.now()),e.type=null!=(t=this.options.type)?t:"flux",e}};var fe=class{constructor(e,t,r){this.executor=e,this.iterableResultExecutor=t,this.chunkCombiner=r}iterateLines(){return r(this.iterableResultExecutor())}iterateRows(){return w(r(this.iterableResultExecutor()))}lines(){return new v(this.executor,e=>t(e,this.chunkCombiner))}rows(){return new v(this.executor,r=>t(m({next(e,t){r.next({values:e,tableMeta:t})},error(e){r.error(e)},complete(){r.complete()}}),this.chunkCombiner))}consumeLines(e){this.executor(t(e,this.chunkCombiner))}consumeRows(e){this.executor(t(m(e),this.chunkCombiner))}collectRows(r=function(e,t){return t.toObject(e)}){let s=[];return new Promise((e,t)=>{this.consumeRows({next(e,t){e=r.call(this,e,t);void 0!==e&&s.push(e)},error(e){t(e)},complete(){e(s)}})})}collectLines(){let r=[];return new Promise((e,t)=>{this.consumeLines({next(e){r.push(e)},error(e){t(e)},complete(){e(r)}})})}},de=class{constructor(e){if("string"==typeof e)this._options={url:e};else{if(null===e||"object"!=typeof e)throw new c("No url or configuration specified!");this._options=Object.assign({},e)}var e=this._options.url;if("string"!=typeof e)throw new c("No url specified!");e.endsWith("/")&&(this._options.url=e.substring(0,e.length-1)),this.transport=null!=(e=this._options.transport)?e:new ue(this._options),delete this._options.token,this.processCSVResponse=(e,t)=>new fe(e,t,this.transport.chunkCombiner)}getWriteApi(e,t,r="ns",s){return new le(this.transport,e,t,r,null!=s?s:this._options.writeOptions)}getQueryApi(e){return new ce(this.transport,this.processCSVResponse,e)}};return e=e,((t,r,s,i)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let e of P(r))M.call(t,e)||e===s||n(t,e,{get:()=>r[e],enumerable:!(i=N(r,e))||i.enumerable});return t})(n({},"__esModule",{value:!0}),e)})();Object.defineProperty(e,"__esModule",{value:!0}),Object.assign(e,t)});
//# sourceMappingURL=index.min.js.map